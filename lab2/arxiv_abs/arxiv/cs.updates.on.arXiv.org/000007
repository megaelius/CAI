In this paper, we consider the power allocation of the physical layer and the buffer delay of the upper
application layer in energy harvesting green networks. We analyze the delay-optimal power allocation
problem over fading channels. The total power required for reliable transmission includes the
transmission power and the circuit power. The harvested power (which is stored in a battery) and
the grid power constitute the power resource. The objective is to find a policy to minimize the buffer
delay under the constraint on the average grid power. The policy is a two-dimensional vector with
the transmission rate and the power allocation of the battery as its elements. In each transmission,
the transmitter decides the transmission rate as well as the allocated power from the battery, and
the rest of the required power will be supplied by the power grid. A constrained Markov decision process
(MDP) problem is formulated when the data arrival process, the harvested energy arrival process,
and the channel process are Markovian. The following two cases are respectively considered. First,
the battery capacity is considered infinite. We solve the optimal rate through a reduced MDP problem
that is only related to the average harvested energy but not the harvested energy arrival process.
And then the battery's power allocation can be given based on the optimal rate. Second, when the battery
capacity is finite, we derive the structural properties of the optimal two-dimensional solution
through the transformations to the average cost MDP and discount cost MDP. Two necessary conditions
for the optimal policy are obtained. Moreover, we discuss the dimension reduction of the policy
under finite capacity. Finally, based on the theoretical analysis, we propose specific deterministic
policies and simulations are performed under these policies. 