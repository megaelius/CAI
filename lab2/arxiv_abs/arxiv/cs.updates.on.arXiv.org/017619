We study an urban bike lane planning problem based on the fine-grained bike trajectory data, which
is made available by smart city infrastructure such as bike-sharing systems. The key decision is
where to build bike lanes in the existing road network. As bike-sharing systems become widespread
in the metropolitan areas over the world, bike lanes are being planned and constructed by many municipal
governments to promote cycling and protect cyclists. Traditional bike lane planning approaches
often rely on surveys and heuristics. We develop a general and novel optimization framework to guide
the bike lane planning from bike trajectories. We formalize the bike lane planning problem in view
of the cyclists' utility functions and derive an integer optimization model to maximize the utility.
To capture cyclists' route choices, we develop a bilevel program based on the Multinomial Logit
model. We derive structural properties about the base model and prove that the Lagrangian dual of
the bike lane planning model is polynomial-time solvable. Furthermore, we reformulate the route
choice based planning model as a mixed integer linear program using a linear approximation scheme.
We develop tractable formulations and efficient algorithms to solve the large-scale optimization
problem. Via a real-world case study with a city government, we demonstrate the efficiency of the
proposed algorithms and quantify the trade-off between the coverage of bike trips and continuity
of bike lanes. We show how the network topology evolves according to the utility functions and highlight
the importance of understanding cyclists' route choices. The proposed framework drives the data-driven
urban planning scheme in smart city operations management. 