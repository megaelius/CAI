With wireless network virtualization, Mobile Virtual Network Operators (MVNOs) can develop new
services on a low-cost platform by leasing virtual resources from mobile network owners. In this
paper, we investigate a two-stage spectrum leasing framework, where an MVNO acquires radio spectrum
through both advance reservation and on-demand request. To maximize its surplus, the MVNO jointly
optimizes the amount of spectrum to lease in the two stages by taking into account the traffic distribution,
random user locations, wireless channel statistics, Quality of Service (QoS) requirements, and
the prices differences. Meanwhile, the acquired spectrum resources are dynamically allocated
to the MVNO's mobile subscribers (users) according to fast channel fadings in order to maximize
the utilization of the resources. The MVNO's surplus maximization problem is naturally formulated
as a tri-level nested optimization problem that consists of Dynamic Resource Allocation (DRA),
on-demand request, and advance reservation subproblems. To solve the problem efficiently, we
rigorously analyze the structure of the optimal solution in the DRA problem, and the optimal value
is used to find the optimal leasing decisions in the two stages. In particular, we derive closed-form
expressions of the optimal advance reservation and on-demand requests when the proportional fair
utility function is adopted. We further extend the analysis to general utility functions and derive
a Stochastic Gradient Decent (SGD) algorithm to find the optimal leasing decisions. Simulation
results show that the two-stage spectrum leasing strategy can take advantage of both the price discount
of advance reservation and the flexibility of on-demand request to deal with traffic variations.
