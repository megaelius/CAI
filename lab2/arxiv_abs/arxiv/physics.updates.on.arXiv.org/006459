Commercially available passive magnetic shields with active components that allow the generation
of a tailored low-field environment are required for many applications in science, engineering,
and medical imaging. Until now, accurate field nulling, or field generation, has only been possible
over a small fraction of the overall volume of the shield. This is due to the interaction between the
active field-generating components and the surrounding high-permeability passive shielding
material. Such material distorts the field generated by the active parts, making it hard to optimize
the spatial variation of the field ab initio. Here, we show that this design problem can be overcome
for cylindrical shields with planar end-caps by explicitly including the interactions with the
passive shielding layers in the optimization procedure for the active field-generating components.
We modify the Green's function for the magnetic vector potential so that it satisfies the boundary
conditions of the passive shield, and then apply a harmonic minimization method. We design two hybrid
active--passive systems inside a closed cylindrical perfect magnetic conductor, which generate
a constant transverse field, $B_x$, across the cylinder, and a linear transverse field gradient,
$\mathbf{B}=(z~\mathbf{\hat{x}}+x~\mathbf{\hat{z}})$, along the axis of the cylinder. The
fields generated by both the constant transverse and linear gradient systems are within $0.1\%$
and $0.5\%$ of the desired target field, respectively, over $40\%$ of the central radial and axial
extent of a simulated passive magnetic shield. Our optimization procedure can be adapted to design
active--passive systems that generate any user-specified static magnetic field in the interior
of a closed cylindrical shield of any length, enabling the development and miniaturization of systems
that require accurate magnetic shielding and control. 