One of the main scenarios of planet formation is the core accretion model where a massive core forms
first and then accretes a gaseous envelope. This core forms by accreting solids, either planetesimals,
or pebbles. A key constraint in this model is that the accretion of gas must proceed before the dissipation
of the gas disc. Classical planetesimal accretion scenario predicts that the time needed to form
a giant planets core is much longer than the time needed to dissipate the disc. This difficulty led
to the development of another accretion scenario, in which cores grow by accretion of pebbles, which
are much smaller and thus more easily accreted, leading to a more rapid formation. The aim of this
paper is to compare our updated pebble-based planet formation model with observations, in particular
the well studied metallicity effect. We adopt the Bitsch et al. 2015a disc model and the Bitsch et
al. 2015b pebble model and use a population synthesis approach to compare the formed planets with
observations. We find that keeping the same parameters as in Bitsch et al. 2015b leads to no planet
growth due to a computation mistake in the pebble flux (Bitsch et al. 2017). Indeed a large fraction
of the heavy elements should be put into pebbles (Zpeb/Ztot = 0.9) in order to form massive planets
using this approach. The resulting mass functions show a huge amount of giants and a lack of Neptune
mass planets, which are abundant according to observations. To overcome this issue we include the
computation of the internal structure for the planetary atmosphere to our model. This leads to the
formation of Neptune mass planets but no observable giants. Reducing the opacity of the planetary
envelope finally matches observations better. We conclude that modeling the internal structure
for the planetary atmosphere is necessary to reproduce observations. 