Transit observations in the MgI line of HD209458b revealed signatures of neutral magnesium escaping
the upper atmosphere of the planet, while no atmospheric absorption was found in the MgII doublet.
Here we present a 3D particle model of the dynamics of neutral and ionized magnesium populations,
coupled with an analytical modeling of the atmosphere below the exobase. Theoretical MgI absorption
line profiles are directly compared with the absorption observed in the blue wing of the line during
the planet transit. Observations are well-fitted with an escape rate of neutral magnesium in the
range 2x10^7-3.4x10^7 g/s, an exobase close to the Roche lobe (Rexo in the range 2.1-4.3 Rp, where
Rp is the planet radius) and a planetary wind velocity at the exobase vpl=25km/s. The observed velocities
of the planet-escaping magnesium up to -60km/s are well explained by radiation pressure acceleration,
provided that UV-photoionization is compensated for by electron recombination up to about 13Rp.
If the exobase properties are constrained to values given by theoretical models of the deeper atmosphere
(Rexo=2Rp and vpl=10km/s), the best fit to the observations is found at a similar electron density
and escape rate within 2 sigma. In all cases, the mean temperature of the atmosphere below the exobase
must be higher than about 6100 K. Simulations predict a redward expansion of the absorption profile
from the beginning to the end of the transit. The spatial and spectral structure of the extended atmosphere
is the result of complex interactions between radiation pressure, planetary gravity, and self-shielding,
and can be probed through the analysis of transit absorption profiles in the MgI line. 