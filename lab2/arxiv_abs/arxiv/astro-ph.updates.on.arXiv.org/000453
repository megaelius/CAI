We estimate the galaxy stellar mass function and stellar mass density for star-forming and quiescent
galaxies with 0.2<z<4. We construct a deep K<24 sample of 220,000 galaxies selected using
the UltraVISTA DR1 data release. Our analysis is based on precise 30-band photometric redshifts.
By comparing these photometric redshifts with 10,800 spectroscopic redshifts from the zCOSMOS
surveys, we find a precision of sigma((zp-zs)/(1+zs))=0.008 at i<22.5 and sigma((zp-zs)/(1+zs))=0.03
at 1.5<z<4. We derive the stellar mass function and correct for the Eddington bias. We find
a mass-dependent evolution of the global and star-forming populations, with the low-mass end of
the mass functions evolving more rapidly than the high-mass end. This mass-dependent evolution
is a direct consequence of the star formation being quenched in galaxies more massive than M>10^10.7Msun.
For the mass function of the quiescent galaxies, we do not find any significant evolution of the high-mass
end at z<1; however we observe a clear flattening of the faint-end slope. From z~3 to z~1, their
comoving stellar mass density increases by 1.6 dex between z~3 and z~1 and by less than 0.2 dex at z<1.
Following Wilkins et al. (2008), we infer the star formation history from the mass density evolution.
This inferred star formation history is in excellent agreement with SFR measurements at z<1.5,
while we find differences of 0.2 dex at z>1.5 consistent with the expected uncertainties. We
also develop a new method to infer the specific SFR from the mass function of star-forming galaxies.
We find that the sSFR of 10^10Msun galaxies increases continuously in the redshift range 1<z<4.
Finally, we compare our results with the semi-analytical model and find that these models overestimate
the density of low mass quiescent galaxies by an order of magnitude, while the density of low-mass
star-forming galaxies is successfully reproduced. 