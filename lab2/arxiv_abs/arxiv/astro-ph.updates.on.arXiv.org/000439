We present an update to the multiphase SPH galaxy formation code by Scannapieco et al. We include
a more elaborate treatment of the production of metals, cooling rates based on individual element
abundances, and a scheme for the turbulent diffusion of metals. Our SN feedback model now transfers
energy to the ISM in kinetic and thermal form, and we include a prescription for the effects of radiation
pressure from massive young stars on the ISM. We calibrate our new code on the well studied Aquarius
haloes and then use it to simulate a sample of 16 galaxies with halo masses between 1x10^11 and 3x10^12
M_sun. In general, the stellar masses of the sample agree well with the stellar mass to halo mass relation
inferred from abundance matching techniques for redshifts z=0-4. There is however a tendency to
overproduce stars at z>4 and to underproduce them at z<0.5 in the least massive haloes. Overly
high SFRs at z<1 for the most massive haloes are likely connected to the lack of AGN feedback in
our model. The simulated sample also shows reasonable agreement with observed star formation rates,
sizes, gas fractions and gas-phase metallicities at z=0-3. Remaining discrepancies can be connected
to deviations from predictions for star formation histories from abundance matching. At z=0, the
model galaxies show realistic morphologies, stellar surface density profiles, circular velocity
curves and stellar metallicities, but overly flat metallicity gradients. 15 out of 16 of our galaxies
contain disk components with kinematic disk fraction ranging between 15 and 65 %. The disk fraction
depends on the time of the last destructive merger or misaligned infall event. Considering the remaining
shortcomings of our simulations we conclude that even higher kinematic disk fractions may be possible
for LambdaCDM haloes with quiet merger histories, such as the Aquarius haloes. 