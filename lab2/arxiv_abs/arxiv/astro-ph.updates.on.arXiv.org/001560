We developed a {\sl coronal non-linear force-free field (COR-NLFFF)} forward-fitting code that
fits an approximate {\sl non-linear force-free field (NLFFF)} solution to the observed geometry
of automatically traced coronal loops. In contrast to photospheric NLFFF codes, which calculate
a magnetic field solution from the constraints of the transverse photospheric field, this new code
uses coronal constraints instead, and this way provides important information on systematic errors
of each magnetic field calculation method, as well as on the non-forcefreeness in the lower chromosphere.
In this study we applied the COR-NLFFF code to active region NOAA 11158, during the time interval
of 2011 Feb 12 to 17, which includes an X2.2 GOES-class flare plus 35 M and C-class flares. We calcuated
the free magnetic energy with a 6-minute cadence over 5 days. We find good agreement between the two
types of codes for the total nonpotential $E_N$ and potential energy $E_P$, but find up to a factor
of 4 discrepancy in the free energy $E_{free}=E_N-E_P$, and up to a factor of 10 discrepancy in the
decrease of the free energy $\Delta E_{free}$ during flares. The coronal NLFFF code exhibits a larger
time variability, and yields a decrease of free energy during the flare that is sufficient to satisfy
the flare energy budget, while the photospheric NLFFF code shows much less time variability and
an order of magnitude less free energy decrease during flares. The discrepancy may partly be due
to the pre-processing of photospheric vector data, but more likely due to the non-forcefreeness
in the lower chromosphere. We conclude that the coronal field cannot be correctly calculated based
on photospheric data alone, but requires additional information on coronal loop geometries. 