We use large hybrid (kinetic ions-fluid electrons) simulations to study ion acceleration and generation
of magnetic turbulence due to the streaming of energetic particles that are self-consistently
accelerated at non-relativistic shocks. When acceleration is efficient (at quasi-parallel shocks),
we find that the magnetic field develops transverse components and is significantly amplified
in the pre-shock medium. The total amplification factor is larger than 10 for shocks with Mach number
$M=100$, and scales with the square root of $M$. We find that in the shock precursor the energy spectral
density of excited magnetic turbulence is proportional to spectral energy distribution of accelerated
particles at corresponding resonant momenta, in good agreement with the predictions of quasilinear
theory of diffusive shock acceleration. We discuss the role of Bell's instability, which is predicted
and found to grow faster than resonant instability in shocks with $M\gtrsim 30$. Ahead of these strong
shocks we distinguish two regions: the far upstream, where magnetic field amplification is provided
by the current of escaping ions via Bell's instability, and the precursor, where amplification
is provided by the current of diffusing ions. The interface between these regions (free-escape
boundary) is determined by the migration to larger wavelengths of non-resonant modes in the nonlinear
stage. Finally, we measure ion diffusion in the self-generated turbulence, and find that it can
be described by Bohm diffusion in the amplified field: the mean free path is of the order of the ion
gyroradius, and the scattering rate is proportional to the energy in magnetic modes with resonant
wavelengths. The obtained scalings for magnetic field amplification and ion diffusion enable
the inclusion of self-consistent microphysics into phenomenological models of cosmic ray acceleration
in supernova remnants. 