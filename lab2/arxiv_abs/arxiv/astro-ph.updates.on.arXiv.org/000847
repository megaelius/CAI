We estimate the galaxy stellar mass function and stellar mass density for star-forming and quiescent
galaxies with 0.2<z<4. We construct a deep K<24 sample of 220000 galaxies selected using
the UltraVISTA DR1 data release. Our analysis is based on precise 30-band photometric redshifts.
By comparing these photometric redshifts with 10800 spectroscopic redshifts from the zCOSMOS
bright and faint surveys, we find a precision of sigma(dz/(1+z))=0.008 at i<22.5 and sigma(dz/(1+zs))=0.03
at 1.5<z<4. We derive the stellar mass function and correct for the Eddington bias. We find
a mass-dependent evolution of the global and star-forming populations. This mass-dependent evolution
is a direct consequence of the star formation being quenched in galaxies more massive than M>10^10.7Msun.
For the mass function of the quiescent galaxies, we do not find any significant evolution of the high-mass
end at z<1; however we observe a clear flattening of the faint-end slope. From z~3 to z~1, the density
of quiescent galaxies increases over the entire mass range. Their comoving stellar mass density
increases by 1.6 dex between z~3 and z~1 and by less than 0.2dex at z<1. We infer the star formation
history from the mass density evolution and we find an excellent agreement with instantaneous star
formation rate measurements at z<1.5, while we find differences of 0.2dex at z>1.5 consistent
with the expected uncertainties. We also develop a new method to infer the specific star formation
rate from the mass function of star-forming galaxies. We find that the specific star formation rate
of 10^10Msun galaxies increases continuously in the redshift range 1<z<4. Finally, we compare
our results with a semi-analytical model and find that these models overestimate the density of
low mass quiescent galaxies by an order of magnitude, while the density of low-mass star-forming
galaxies is successfully reproduced. 