We present a model for the formation of the first galaxies before and after the reionization of hydrogen
in the early universe. In this model, galaxy formation can only take place in dark matter haloes whose
mass exceeds a redshift-dependent critical value, which, before reionization, is equal (in the
simplest case) to the mass at which atomic hydrogen cooling becomes effective and, after reionization,
is equal to the mass above which gas cannot remain in hydrostatic equilibrium. We define the Halo
Occupation Fraction (HOF) as the fraction of haloes that host a luminous galaxy as a function of halo
mass. The HOF is established by the interplay between the evolution of the critical mass and the assembly
history of haloes and depends on three factors: the minimum halo mass for galaxy formation before
reionization, the redshift of reionization, and the intensity of the (evolving) external photoheating
rate. Our fiducial model predicts a cutoff in the galaxy mass function at a present-day halo mass,
$M_{200} \sim 3\times 10^{8} M_{\odot}$; 100\% occupation at $M_{200} > 5\times 10^9 M_{\odot}$;
and a population of starless gaseous haloes of present-day mass in the range $10^{6} \lesssim M_{200}
/ M_{\odot}\lesssim 5\times 10^{9}$, in which the gas is in thermal equilibrium with the ultraviolet
background radiation and in hydrostatic equilibrium in the gravitational potential of the halo.
The transition between HOF = 0 and HOF=1 reflects the stochastic nature of halo mass growth. We explore
how these characteristic masses vary with model assumptions and parameter values. The results
of our model are in excellent agreement with cosmological hydrodynamic simulations of galaxy formation.
