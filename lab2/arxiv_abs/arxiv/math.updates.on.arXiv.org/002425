For a compact oriented surface $\Sigma$ of genus $g$ with $n+1$ boundary components, the space $\mathfrak{g}$
spanned by free homotopy classes of loops in $\Sigma$ carries the structure of a Lie bialgebra. The
Lie bracket was defined by Goldman and it is canonical. The Lie cobracket was defined by Turaev and
it depends on the framing of $\Sigma$. The Lie bialgebra $\mathfrak{g}$ has a natural decreasing
filtration such that both the Goldman bracket and the Turaev cobracket have degree $(-2)$. In this
paper, we address the following Goldman-Turaev formality problem: construct a Lie bialgebra homomorphism
$\theta$ from $\mathfrak{g}$ to its associated graded $gr\, \mathfrak{g}$ such that $gr\, \theta
= {\rm id}$. In order to solve it, we define a family of higher genus Kashiwara-Vergne (KV) problems
for an element $F\in Aut(L)$, where $L$ is a free Lie algebra. In the case of $g=0$ and $n=2$, the problem
for $F$ is the classical KV problem from Lie theory. For $g>0$, these KV problems are new. Our main
results are as follows. On the one hand, every solution of the KV problem induces a GT formality map.
On the other hand, higher genus KV problems admit solutions for any $g$ and $n$. In fact, the solution
reduces to two important cases: $g=0, n=2$ which admits solutions by Alekseev and Torossian and
$g=1, n=1$ for which we construct solutions in terms of certain elliptic associators following
Enriquez. By combining these two results, we obtain a proof of the GT formality for any $g$ and $n$.
We also study the set of solutions of higher genus KV problems and introduce pro-unipotent groups
$KRV^{(g,n+1)}$ which act on them freely and transitively. These groups admit graded pro-nilpotent
Lie algebras $krv^{(g, n+1)}$. We show that the elliptic Lie algebra $krv^{(1,1)}$ contains a copy
of the Grothendieck-Teichmuller Lie algebra $grt_1$ as well as symplectic derivations $\delta_{2n}$.
